pipeline{
    agent any
    stages{
        stage("sonar scan"){
            agent{
                docker{
                    image "maven"
                }
            }
            steps{
                script{
                  withSonarQubeEnv(credentialsId: 'jenkins'){
                     sh 'printenv'
                     sh 'mvn sonar:sonar'
                  }
                  timeout(5){
                   def qg = waitForQualityGate()
                   if (qg.status != 'ok'){
                       error "code didnt met quality gate"
                   }
                   
                  }
            
                }
            }
        }
    }
    post {
        always{
            cleanWs()
        }
    }
}
